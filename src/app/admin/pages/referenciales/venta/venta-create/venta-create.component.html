<app-content-header [title]="'Nueva Venta'"></app-content-header>

<div class="borde">
    <form style="padding: 10px;" nz-form [nzLayout]="'inline'" [formGroup]="saveForm">
        <nz-form-item nz-item>
            <nz-form-label nz-label nzRequired>Clientes</nz-form-label>
            <nz-form-control nzErrorTip="Inserte un valor correcto!">
                <nz-select class="options" name="cliente" nzShowSearch nzAllowClear nzPlaceHolder="Seleccione cliente"
                    formControlName="idcliente">
                    <nz-option *ngFor="let cliente of clientes" [nzValue]="cliente.idcliente"
                        nzLabel={{cliente.razon_social}}>
                    </nz-option>
                </nz-select>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item nz-item>
            <nz-form-label nz-label>Costo de envio</nz-form-label>
            <nz-form-control nzErrorTip="Inserte un valor correcto!">
                <nz-input-group>
                    <input nz-input id="envio" formControlName="costo_envio" type="number" step="0.01" />
                </nz-input-group>
            </nz-form-control>
        </nz-form-item>
    </form>

    <nz-divider style="margin: 10px;width: 80%;"></nz-divider>

    <form style="padding: 10px;" nz-form [nzLayout]="'inline'" [formGroup]="validateForm" (ngSubmit)="agregarVenta()">
        <nz-form-item nz-item>
            <nz-form-label nz-label nzRequired>Productos</nz-form-label>
            <nz-form-control nzErrorTip="Inserte un valor correcto!">
                <nz-input-group>
                    <nz-select class="options" name="producto" nzShowSearch nzAllowClear
                        nzPlaceHolder="Seleccione producto" formControlName="producto">
                        <nz-option *ngFor="let productos of productosFinales" [nzValue]="productos"
                            nzLabel={{productos.nombre}}>
                        </nz-option>
                    </nz-select>
                </nz-input-group>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item nz-item>
            <nz-form-label nz-label nzRequired>Precio</nz-form-label>
            <nz-form-control nzErrorTip="Inserte un valor correcto!">
                <nz-input-group>
                    <input nz-input id="precio" formControlName="precio" type="number" step="0.01" />
                </nz-input-group>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item nz-item>
            <nz-form-label nz-label nzRequired>Cantidad</nz-form-label>
            <nz-form-control nzErrorTip="Inserte un valor correcto!">
                <nz-input-group>
                    <input nz-input id="cantidad" formControlName="cantidad" type="number" />
                </nz-input-group>
            </nz-form-control>
        </nz-form-item>
        <nz-form-item nz-item>
            <nz-form-label nz-label>Descuento</nz-form-label>
            <nz-form-control nzErrorTip="Inserte un valor correcto!">
                <nz-input-group>
                    <input nz-input id="descuento" formControlName="descuento" type="number" />
                </nz-input-group>
            </nz-form-control>
        </nz-form-item>
        <nz-form-item style="width: 100%;">
            <nz-form-control style="display: flex; align-items: center;">
                <button nz-button nzType="primary" type="submit" [disabled]="validateForm.invalid">Agregar</button>
            </nz-form-control>
        </nz-form-item>
    </form>
</div>

<div style="margin: 20px;"></div>

<nz-table #tblventas [nzData]="tblVentas" [nzBordered]="true" [nzShowPagination]="false">
    <thead>
        <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio</th>
            <th>Descuento</th>
            <th>IVA</th>
            <th>Monto IVA</th>
            <th>Subtotal</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let venta of tblventas.data">
            <td>{{ venta.producto.nombre }}</td>
            <td>{{ venta.cantidad }}</td>
            <td>{{ separador(venta.producto.costo) }}</td>
            <td>{{ separador(venta.descuento) }}</td>
            <td>{{ venta.producto.tipo_iva }}%</td>
            <td>{{ separador(venta.iva) }}</td>
            <td>{{ separador(venta.subtotal) }}</td>
            <td>
                <a style="padding: 4px;" nz-popconfirm nzPopconfirmTitle="Seguro que desea extraer?"
                    (nzOnConfirm)="extraeRow(venta)">Delete</a>
            </td>
        </tr>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="2" style="text-align: right;"><strong>Total General:</strong></td>
            <td>{{ separador(totalIva) }}</td>
            <td colspan="2" style="text-align: right;"><strong>Total General:</strong></td>
            <td>{{ separador(totalGeneral) }}</td>
        </tr>
    </tfoot>
</nz-table>
<nz-divider style="margin: 10px;"></nz-divider>
<nz-form-item style="width: 100%;">
    <nz-form-control style="display: flex; align-items: end;">
        <!--button nz-button nzType="primary" type="submit" (click)="submitForm()"
            [disabled]="saveForm.invalid">Guardar</button-->

            <button nz-button nzType="primary" type="submit" (click)="showModal()">Guardar</button>
    </nz-form-control>
</nz-form-item>

<nz-modal [(nzVisible)]="modalIsVisible" nzTitle="Confirmar venta" (nzOnCancel)="handleCancel()" (nzOnOk)="handleOk()">
    <ng-container *nzModalContent>
        <nz-input-group>
            <label nz-label nzRequired>Total</label>
            <br/>
            <input nz-input [value]="totalGeneral" disabled="true" id="total" type="number" step="0.01" />
        </nz-input-group>
        <nz-input-group>
            <label nz-label nzRequired>Monto cliente</label>
            <br/>
            <input nz-input [(ngModel)]="value" (keyup)="generaVuelto()" id="total" type="number" step="0.01" />
        </nz-input-group>
        <nz-input-group>
            <label nz-label nzRequired>Vuelto</label>
            <br/>
            <a style="color: red;">{{vuelto}}</a>
        </nz-input-group>
        
    </ng-container>
</nz-modal>